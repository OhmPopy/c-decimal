#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <magica/decimal.h>

#include "mg_assert.h"

static void divide_test(const char *text1, const char *text2, const char *ret)
{
	char strbuf[1000];
	int size;
	mg_decimal value1, value2, value3, value4, value5;

	mg_assert(mg_decimal_parse_string(text1, &value1) == 0);
	mg_assert(mg_decimal_parse_string(text2, &value2) == 0);

	mg_assert(mg_decimal_divide(&value1, &value2, /*out*/&value3) == 0);

	mg_assert(mg_decimal_to_string(&value3, strbuf, 1000, &size) == 0);

	mg_assert(strcmp(ret, strbuf) == 0);

	mg_assert(mg_decimal_divide_and_modulus(&value1, &value2, /*out*/&value4, /*out*/&value5) == 0);
	mg_assert(mg_decimal_round(/*inout*/&value3, 0, MG_DECIMAL_ROUND_DOWN) == 0);

	mg_assert(mg_decimal_compare(&value3, &value4) == 0);
}

void decimal_divide_test()
{
	clock_t tm = clock();

	divide_test("11111111", "10", "1111111.1");
	divide_test("11111111", "1000", "11111.111");
	divide_test("-111111111111111111111", "1000", "-111111111111111111.111");
	divide_test("-111111111111111111111", "-1000", "111111111111111111.111");
	divide_test("111111111111111111111", "-1000", "-111111111111111111.111");
	divide_test("1959", "2", "979.5");
	divide_test("1000000000000000000000", "2", "500000000000000000000");
	divide_test("1000000", "3", "333333.333333333333333333333333333333");
	divide_test("9999999999999999999999999999999999", "9999999999999999999999999999999999", "1");
	divide_test("9999999999999999999999999999999999", "1", "9999999999999999999999999999999999");
	divide_test("1", "9999999999999999999999999999999999", "0.0000000000000000000000000000000001");
	divide_test("1", "999999999999999999999999999999999", "0.000000000000000000000000000000001");
	divide_test("1678165131.16", "9654.6466879411111111", "173819.424511522428564578144929998874");
	divide_test("8974165.41564", "-8974165564", "-0.000999999983468100856624668352285371");
	divide_test("11111111111165.41564", "-897411111111.65564", "-12.3812943405633566936926641727499868");
	divide_test("11111", "100000000000000000000", "0.00000000000000011111");
	divide_test("987654321009876543210", "987654321009876543210", "1");
	divide_test("98.7654321009876543210", "987654321009.876543210", "0.0000000001");
	divide_test("0.1", "0.1", "1");
	divide_test("0.3", "0.0333333333333333333", "9.000000000000000009");
	divide_test("1", "99999999999999999999999", "0.00000000000000000000001");
	divide_test("1000", "912345756978465", "0.000000000001096075684411391403954103");
	divide_test("999999999.9999", "999999999.9999", "1");
	divide_test("980.8", "3.1415926535", "312.198336377985167070292170200352806");
	divide_test("1", "10", "0.1");
	divide_test("1", "100000000000", "0.00000000001");
	divide_test("89718", "8971899798271890987", "0.00000000000000999988876573063131011");
	divide_test("777", "223", "3.48430493273542600896860986547085201");
	divide_test("123456", "1.05", "117577.142857142857142857142857142857");
	divide_test("123456", "1.08", "114311.111111111111111111111111111111");
	divide_test("123456", "1.10", "112232.727272727272727272727272727272");
	divide_test("123456", "0.00000000000000000000000001", "12345600000000000000000000000000");
	divide_test("123456", "0.0001", "1234560000");
	divide_test("0.0000000000000000000001", "0.0000000000000000000001", "1");
	divide_test("0.000001", "2", "0.0000005");
	divide_test("0.000001", "4", "0.00000025");
	divide_test("0.000001", "8", "0.000000125");
	divide_test("0.000000000000000000001", "2", "0.0000000000000000000005");
	divide_test("0.000000000000000000001", "4", "0.00000000000000000000025");
	divide_test("0.000000000000000000001", "8", "0.000000000000000000000125");
	divide_test("-123456", "1.08", "-114311.111111111111111111111111111111");
	divide_test("-123456", "-1.08", "114311.111111111111111111111111111111");
	divide_test("123456", "-1.08", "-114311.111111111111111111111111111111");
	divide_test("1", "9999", "0.000100010001000100010001000100010001");
	divide_test("1", "999999", "0.000001000001000001000001000001000001");
	divide_test("1", "99999999999999999", "0.0000000000000000100000000000000001");
	divide_test("1", "9999999999999999999", "0.0000000000000000001");
	divide_test("100", "9", "11.1111111111111111111111111111111111");
	divide_test("0.00000000000000000000000000000000001", "4", "0.000000000000000000000000000000000002");
	divide_test("0.0000000000000000000000000000000001", "4", "0.000000000000000000000000000000000025");
	divide_test("0.0000000000000000000000000000000010", "4", "0.00000000000000000000000000000000025");
	divide_test("0.0000000000000000000000000000000100", "4", "0.0000000000000000000000000000000025");
	divide_test("12350", "333", "37.087087087087087087087087087087087");
	divide_test("123456789123456789", "333", "370741108478849.216216216216216216216");
	divide_test("123456789123456789123456789", "333", "370741108478849216586957.324324324324");
	divide_test("3212313211512654132123441131515", "3212313211512654132123441131515", "1");
	divide_test("3212313211512654132123441131515", "321231321151265413212344", "10000000.0000000000000000035224304901");
	divide_test("3212313211512654132123441131515", "3212313211512654132", "1000000000000.00000003842748928485479");
	divide_test("3212313211512654132123441131515", "321231321151", "10000000000008262370.2879630271218714");
	divide_test("3212313211512654132123441131515", "321231", "10000009997517842711704166.5702095999");
	divide_test("3212313211512654132123441131515", "2", "1606156605756327066061720565757.5");
	divide_test("3212313211512654132123441131515", "1", "3212313211512654132123441131515");
	divide_test("3212313211512654132123441131515", "321231321151265413212344", "10000000.0000000000000000035224304901");
	divide_test("3212313211512654132.123441131515", "3212313211512654132", "1.00000000000000000003842748928485479");
	divide_test("321231321151265413212.3441131515", "321231321151", "1000000000.00082623702879630271218714");
	divide_test("3212313211512654132123441131515", "321231", "10000009997517842711704166.5702095999");
	divide_test("3212313211512654132123.441131515", "2", "1606156605756327066061.7205657575");
	divide_test("321231321151265.4132123441131515", "1", "321231321151265.4132123441131515");
	divide_test("123456789.0", "101111", "1221.00255165115566061061605562203914");
	divide_test("3212313211512654132123441131516", "3212313211512654132123441131516", "1");
	divide_test("3212313211512654132123441131516", "3212313211512654132123441", "1000000.00000000000000000004094121318");
	divide_test("3212313211512654132123441131516", "32123132115126541321", "100000000000.000000000729727457210243");
	divide_test("3212313211512654132123441131516", "32123132115126", "100000000000001685.14462559651891458");
	divide_test("3212313211512654132123441131516", "32123132", "100000000358391396334686.204680041784");
	divide_test("3212313211512654132123441131516", "3212", "1000097512924238521831706454.39476961");
	divide_test("3212313211512654132123441131516", "99", "32447608197097516486095364964.8080808");
	divide_test("3212313211512654132123441131516", "16", "200769575719540883257715070719.75");
	divide_test("3212313211512654132123441131516", "8", "401539151439081766515430141439.5");
	divide_test("3212313211512654132123441131516", "7", "458901887358950590303348733073.714285");
	divide_test("3212313211512654132123441131516", "4", "803078302878163533030860282879");
	divide_test("3212313211512654132123441131516", "2", "1606156605756327066061720565758");
	divide_test("3212313211512654132123441131516", "1", "3212313211512654132123441131516");
	divide_test("999999999999999999999999999999999999", "999999999999999999999999999999999999", "1");
	divide_test("9999999999999999999999999999999999", "9999999999999999999999999999999999", "1");
	divide_test("9999999999999999999999999999999999", "9999999999999999999999999999999", "1000.0000000000000000000000000000999");
	divide_test("9999999999999999999999999999999999", "9999999999999999999999999999", "1000000.0000000000000000000000999999");
	divide_test("9999999999999999999999999999999999", "9999999999999999999999999", "1000000000.0000000000000000999999999");
	divide_test("9999999999999999999999999999999999", "9999999999999999999999", "1000000000000.0000000000999999999999");
	divide_test("9999999999999999999999999999999999", "9999999999999999999", "1000000000000000.0000999999999999999");
	divide_test("9999999999999999999999999999999999", "9999999999999999", "1000000000000000100.0000000000000099");
	divide_test("9999999999999999999999999999999999", "9999999999999", "1000000000000100000000.0000099999999");
	divide_test("9999999999999999999999999999999999", "9999999999", "1000000000100000000010000.0000009999");
	divide_test("9999999999999999999999999999999999", "9999999", "1000000100000010000001000000.0999999");
	divide_test("9999999999999999999999999999999999", "9999", "1000100010001000100010001000100.0099");
	divide_test("9999999999999999999999999999999999", "9", "1111111111111111111111111111111111");
	divide_test("81", "9", "9");
	divide_test("1000.0005", "1000.0005", "1");
	divide_test("1000.0005", "100.0005", "9.99995500022499887500562497187514062");
	divide_test("1000.0005", "10.0005", "99.9950502474876256187190640467976601");
	divide_test("1000.0005", "1.0005", "999.500749625187406296851574212893553");
	divide_test("-1959", "2", "-979.5");
	divide_test("1959", "-2", "-979.5");
	divide_test("-1959", "-2", "979.5");
	divide_test("100000000000000000000000000000000", "10000000000000000000000000000000", "10");
	divide_test("100000000000000000000000000000000", "10000000000000000000000000000", "10000");
	divide_test("100000000000000000000000000000000", "100000000000000000000000", "1000000000");
	divide_test("100000000000000000000000000000000", "1000000000000000000", "100000000000000");
	divide_test("100000000000000000000000000000000", "1000000000000", "100000000000000000000");
	divide_test("100000000000000000000000000000000", "1000000", "100000000000000000000000000");
	divide_test("100000000000000000000000000000000", "10", "10000000000000000000000000000000");
	divide_test("10000000000000000000000000000", "100000000000000000000000000000000", "0.0001");
	divide_test("100000000000000000000000", "100000000000000000000000000000000", "0.000000001");
	divide_test("1000000000000000000", "100000000000000000000000000000000", "0.00000000000001");
	divide_test("1000000000000", "100000000000000000000000000000000", "0.00000000000000000001");
	divide_test("1000000", "100000000000000000000000000000000", "0.00000000000000000000000001");
	divide_test("100000000000000000000000000", "100000000000000000000000000", "1");
	divide_test("100000000000000000000000000", "10000000000000000000000", "10000");
	divide_test("100000000000000000000000000", "100000000000000000", "1000000000");
	divide_test("100000000000000000000000000", "100000000000000", "1000000000000");
	divide_test("100000000000000000000000000", "1000000000000", "100000000000000");
	divide_test("100000000000000000000000000", "1000000", "100000000000000000000");
	divide_test("100000000000000000000000000", "10", "10000000000000000000000000");
	divide_test("100000000000000000000000000", "100000000000000000000000000", "1");
	divide_test("10000000000000000000000", "100000000000000000000000000", "0.0001");
	divide_test("100000000000000000", "100000000000000000000000000", "0.000000001");
	divide_test("100000000000000", "100000000000000000000000000", "0.000000000001");
	divide_test("1000000000000", "100000000000000000000000000", "0.00000000000001");
	divide_test("1000000", "100000000000000000000000000", "0.00000000000000000001");
	divide_test("10", "100000000000000000000000000", "0.0000000000000000000000001");
	divide_test("10000000000000000000000", "10000000000000000000000", "1");
	divide_test("10000000000000000000000", "100000000000000000", "100000");
	divide_test("10000000000000000000000", "100000000000000", "100000000");
	divide_test("10000000000000000000000", "1000000000000", "10000000000");
	divide_test("10000000000000000000000", "1000000", "10000000000000000");
	divide_test("10000000000000000000000", "10", "1000000000000000000000");
	divide_test("10000000000000000000000", "10000000000000000000000", "1");
	divide_test("100000000000000000", "10000000000000000000000", "0.00001");
	divide_test("100000000000000", "10000000000000000000000", "0.00000001");
	divide_test("1000000000000", "10000000000000000000000", "0.0000000001");
	divide_test("1000000", "10000000000000000000000", "0.0000000000000001");
	divide_test("10", "10000000000000000000000", "0.000000000000000000001");
	divide_test("100000000000000000", "100000000000000000", "1");
	divide_test("100000000000000000", "100000000000000", "1000");
	divide_test("100000000000000000", "1000000000000", "100000");
	divide_test("100000000000000000", "1000000", "100000000000");
	divide_test("100000000000000000", "10", "10000000000000000");
	divide_test("100000000000000000", "100000000000000000", "1");
	divide_test("1000000000000", "100000000000000000", "0.00001");
	divide_test("1000000", "100000000000000000", "0.00000000001");
	divide_test("10", "100000000000000000", "0.0000000000000001");
	divide_test("10000000000000", "10000000000000", "1");
	divide_test("10000000000000", "1000000", "10000000");
	divide_test("10000000000000", "10", "1000000000000");
	divide_test("10000000000000", "10000000000000", "1");
	divide_test("1000000", "10000000000000", "0.0000001");
	divide_test("10", "10000000000000", "0.000000000001");
	divide_test("10000000", "10000000", "1");
	divide_test("10000000", "10000", "1000");
	divide_test("10000000", "10", "1000000");
	divide_test("10000000", "10000000", "1");
	divide_test("10000", "10000000", "0.001");
	divide_test("10", "10000000", "0.000001");
	divide_test("10000000", "10000000", "1");
	divide_test("10000000", "10000", "1000");
	divide_test("10000000", "10", "1000000");
	divide_test("10000000", "10000000", "1");
	divide_test("10000", "10000000", "0.001");
	divide_test("10", "10000000", "0.000001");
	divide_test("10000000", "-10000000", "-1");
	divide_test("10000000", "-10000", "-1000");
	divide_test("10000000", "-10", "-1000000");
	divide_test("10000000", "-10000000", "-1");
	
	printf("TEST mg_decimal_divide(): OK\n");
}
